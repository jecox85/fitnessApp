<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bodyweight Fitness: About</title>
    <link rel="stylesheet" href="../css/materialize.min.css">
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/app.css">
    <link rel="manifest" href="../manifest.json">
    <script type="text/javascript" src="../js/materialize.min.js"></script>
</head>

<!--Top bar area-->
<body class="grey lighten-4">
<nav class="blue darken-3">
    <div class="nav-wrapper container">
        <b><span style="font-size: 170%; ">Bodyweight Fitness</span></b>
        <span class="right grey-text text-darken-3">
                <i class="material-icons sidenav-trigger" data-target="side-menu">menu</i>
            </span>
    </div>
</nav>

<!--side navigation pop-out-->
<ul id="side-menu" class="sidenav side-menu">
    <li><a class="subheader">BODYWEIGHT FITNESS</a></li>
    <li><a href="/index.html" class="waves-effect">Home</a></li>
    <li><a href="/pages/workoutStart.html" class="waves-effect">Start Workout</a>
    <li><a href="/pages/archive.html" class="waves-effect">History</a>
    <li><a href="/pages/about.html" class="waves-effect">About</a></li>
    </li>
</ul>
<!-- Content -->
<div class="container">
    <h5 class="center-align">Workout History</h5>
    <table id="workout-table">
        <th>User</th>
        <th>Date</th>
        <th>Delete</th>
    </table>
    <ul id="user-list"></ul>  
</div>


<script src="../js/ui.js" type="text/javascript"></script>
<script src="/js/app.js"></script>
<!-- Firebase stuff -->
<script type="module">
    let saveButton = document.querySelector("#saveBtn");
    
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics.js";
    import { getFirestore, collection, getDocs, addDoc, doc, deleteDoc, query, where, updateDoc} from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
    apiKey: "AIzaSyC7R_aMW6FCYxcWOmU_1RNaWB5aqJwAyPM",
    authDomain: "fitness-app-35745.firebaseapp.com",
    projectId: "fitness-app-35745",
    storageBucket: "fitness-app-35745.appspot.com",
    messagingSenderId: "111468032003",
    appId: "1:111468032003:web:1acf8f1fb184231f5f5e36",
    measurementId: "${config.measurementId}"
    };

    // Initialize Firebase
    //getAnalytics was causing an error locally
    //const analytics = getAnalytics(app);
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    async function getWorkouts(db){
        const workoutCol = collection(db, "workouts");
        const workoutSnapshot = await getDocs(workoutCol);
        const userList = workoutSnapshot.docs.map((doc) => doc.data());
        return workoutList;
    }
    const workoutList = document.querySelector('#workout-table');

    //Shows the list of the workouts in the database and adds an x that allows for deletion
    function renderWorkouts(dc){
        let newTr = document.createElement("tr");
        let cross = document.createElement('td');
        cross.innerText = 'x';
        cross.setAttribute('data-id', dc.id);
        newTr.innerHTML = `<td>${dc.data().user}</td><td>${dc.data().Date}</td>`;
        newTr.appendChild(cross);
        workoutList.appendChild(newTr);

        cross.addEventListener('click', (e) =>{
            e.stopPropagation();
            let id = e.target.getAttribute('data-id');
            deleteDoc(doc(db, "workouts", id));
        })
    }

    const workouts = getDocs(collection(db, "workouts")).then((snapshot) => {
        snapshot.forEach((doc) => {
            renderWorkouts(doc);
        })
    })
    
</script>
</body>

</html>